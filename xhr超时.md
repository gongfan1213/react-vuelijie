> ğŸ’­ å—¯ï¼Œç”¨æˆ·é—®çš„æ˜¯å¦‚ä½•ç”¨åŸç”Ÿçš„ XMLHttpRequest (XHR) å®ç°è¯·æ±‚è¶…æ—¶ã€‚æˆ‘è®°å¾—XHRæœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥çš„è¶…æ—¶è®¾ç½®ï¼Œä¸è¿‡å¯èƒ½æ˜¯åœ¨æŸä¸ªç‰ˆæœ¬ä¹‹åæ”¯æŒäº†timeoutå±æ€§ï¼Ÿè®©æˆ‘æƒ³ä¸€æƒ³ã€‚
>
> é¦–å…ˆï¼Œæˆ‘åº”è¯¥ç¡®è®¤XHRå¯¹è±¡æ˜¯å¦æœ‰åŸç”Ÿçš„è¶…æ—¶æ”¯æŒã€‚ä»¥å‰å¯èƒ½æ²¡æœ‰ï¼Œä½†HTML5ä¸­å¥½åƒç»™XHRå¢åŠ äº†timeoutå±æ€§ã€‚æ²¡é”™ï¼ŒXHR Level 2 è§„èŒƒä¸­ç¡®å®å¼•å…¥äº†è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®xhr.timeoutæ¥æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ç„¶åé€šè¿‡ç›‘å¬ontimeoutäº‹ä»¶æ¥å¤„ç†è¶…æ—¶ã€‚ä½†è¿™éœ€è¦è€ƒè™‘å…¼å®¹æ€§é—®é¢˜ï¼Œå› ä¸ºæ—§çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒè¿™ä¸ªå±æ€§ã€‚
>
> ä¸è¿‡é—®é¢˜è¿˜åœ¨äºï¼Œç”¨æˆ·å¯èƒ½éœ€è¦åœ¨ä¸æ”¯æŒtimeoutå±æ€§çš„ç¯å¢ƒä¸­å¦‚ä½•å®ç°è¶…æ—¶ã€‚ä¹Ÿä¸æ’é™¤æœ‰äº›å¼€å‘è€…å¯èƒ½ä¸çŸ¥é“XHRå·²ç»æœ‰äº†è¿™ä¸ªå±æ€§ï¼Œæˆ–è€…éœ€è¦å…¼å®¹è€æµè§ˆå™¨çš„æƒ…å†µã€‚è¿™æ—¶å€™å°±éœ€è¦æ‰‹åŠ¨è®¾ç½®è¶…æ—¶æœºåˆ¶äº†ï¼Œæ¯”å¦‚ä½¿ç”¨setTimeoutæ¥è§¦å‘è¶…æ—¶ï¼Œå¹¶åœ¨è¶…æ—¶åæ‰‹åŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚
>
> äºæ˜¯ï¼Œæˆ‘éœ€è¦åˆ†ä¸¤éƒ¨åˆ†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼šé¦–å…ˆä»‹ç»åŸç”Ÿæ”¯æŒçš„timeoutå±æ€§ï¼Œå…¼å®¹æ€§è‰¯å¥½æƒ…å†µä¸‹çš„ä½¿ç”¨æ–¹æ³•ï¼›å…¶æ¬¡ï¼Œå¯¹äºä¸æ”¯æŒçš„æƒ…å†µï¼Œå¦‚ä½•ç”¨setTimeoutå’Œabortæ–¹æ³•æ‰‹åŠ¨å®ç°è¶…æ—¶æ§åˆ¶ã€‚
>
> é¦–å…ˆï¼Œä½¿ç”¨åŸç”Ÿtimeoutå±æ€§çš„æ–¹æ³•ã€‚
>
> ä¾‹å¦‚ï¼š
>
> xhr.timeout = 5000; // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5ç§’
>
> xhr.ontimeout = function() { 
>
>   // å¤„ç†è¶…æ—¶é€»è¾‘
>
> };
>
> è¿™ç§æ–¹æ³•ç®€å•ç›´æ¥ï¼Œä½†éœ€ç¡®è®¤ç”¨æˆ·çš„æµè§ˆå™¨æ”¯æŒæƒ…å†µã€‚å¦‚æœæ”¯æŒçš„è¯ï¼Œåº”è¯¥æ˜¯é¦–é€‰ã€‚
>
> å…¶æ¬¡ï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒtimeoutå±æ€§ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿã€‚è¿™æ—¶å€™éœ€è¦ç»“åˆsetTimeoutå’Œabortæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œå°±æ‰‹åŠ¨è°ƒç”¨xhr.abort()æ¥ç»ˆæ­¢è¯·æ±‚ï¼Œå¹¶åœ¨é”™è¯¯å¤„ç†ä¸­åŒºåˆ†è¶…æ—¶å’Œå…¶ä»–é”™è¯¯ã€‚
>
> éœ€è¦æ³¨æ„çš„åœ°æ–¹åœ¨äºï¼Œå½“è¯·æ±‚æ­£å¸¸å®Œæˆæ—¶ï¼Œéœ€è¦æ¸…é™¤å®šæ—¶å™¨ï¼Œå¦åˆ™å¯èƒ½ä¼šåœ¨è¯·æ±‚æˆåŠŸåä»è§¦å‘è¶…æ—¶å›è°ƒã€‚å› æ­¤ï¼Œéœ€è¦åœ¨onreadystatechangeæˆ–onloadç­‰äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ¸…é™¤å®šæ—¶å™¨ã€‚
>
> å¦å¤–ï¼Œå¤„ç†åŒæ­¥å’Œå¼‚æ­¥è¯·æ±‚çš„é—®é¢˜ã€‚å¦‚æœä½¿ç”¨åŒæ­¥XHRï¼Œè®¾ç½®è¶…æ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä½†é€šå¸¸ä¸æ¨èåŒæ­¥è¯·æ±‚ï¼Œå› ä¸ºä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚å› æ­¤ï¼Œä¸‹é¢åªè€ƒè™‘å¼‚æ­¥çš„æƒ…å†µã€‚
>
> ä¸¾ä¾‹æ¥è¯´ï¼š
>
> var xhr = new XMLHttpRequest();
>
> var timeout = setTimeout(function() {
>
>   xhr.abort(); // ä¸­æ­¢è¯·æ±‚
>
>   // å¤„ç†è¶…æ—¶é€»è¾‘
>
> }, 5000);
>
> xhr.onreadystatechange = function() {
>
>   if (xhr.readyState === 4) {
>
>     clearTimeout(timeout); // æ¸…é™¤å®šæ—¶å™¨
>
>     if (xhr.status === 200) {
>
>       // å¤„ç†æˆåŠŸå“åº”
>
>     } else {
>
>       // å¤„ç†å…¶ä»–é”™è¯¯
>
>     }
>
>   }
>
> };
>
> xhr.open('GET', url, true);
>
> xhr.send();
>
> è¿™æ ·ï¼Œåœ¨å‘é€è¯·æ±‚çš„åŒæ—¶å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å®Œæˆå°±ç»ˆæ­¢è¯·æ±‚ï¼Œå¦åˆ™æ¸…é™¤å®šæ—¶å™¨ã€‚ç„¶è€Œï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼Œä½†è¿™æ˜¯å…¼å®¹æ—§æµè§ˆå™¨çš„è§£å†³æ–¹æ¡ˆã€‚
>
> è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtimeoutäº‹ä»¶å’Œæ‰‹åŠ¨abortäº‹ä»¶å¯èƒ½ä¼šå¯¼è‡´è§¦å‘onerroræˆ–onabortäº‹ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚åœ¨æ‰‹åŠ¨è¶…æ—¶æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯æˆ–è€…æ‰§è¡Œç‰¹å®šçš„å›è°ƒã€‚
>
> ç»¼ä¸Šï¼Œç”¨æˆ·éœ€è¦çš„å¯èƒ½æ˜¯ä¸€ä¸ªèƒ½å¤ŸåŒæ—¶è¦†ç›–æ”¯æŒtimeoutå±æ€§å’Œä¸æ”¯æŒçš„æƒ…å†µçš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•ã€‚åœ¨å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä½¿ç”¨timeoutå±æ€§æ›´ç®€æ´é«˜æ•ˆï¼Œè€Œåœ¨å…¼å®¹æ—§æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦é¢å¤–çš„å¤„ç†ã€‚
>
> å¯èƒ½çš„é—®é¢˜æ˜¯å¦‚ä½•åŒºåˆ†ä¸åŒçš„é”™è¯¯åŸå› ï¼Œæ¯”å¦‚æ˜¯è¶…æ—¶è¿˜æ˜¯å…¶ä»–é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œæ‰‹åŠ¨è°ƒç”¨abortä¼šè§¦å‘onabortäº‹ä»¶ï¼Œè€Œä¸æ˜¯ontimeoutï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªäº‹ä»¶ä¸­å¤„ç†è¶…æ—¶çš„é€»è¾‘ã€‚æˆ–è€…ï¼Œè®¾ç½®ä¸€ä¸ªæ ‡å¿—å˜é‡ï¼Œåœ¨è¶…æ—¶è§¦å‘åå¤„ç†ç‰¹å®šçš„é€»è¾‘ï¼Œç„¶ååœ¨å…¶ä»–é”™è¯¯æƒ…å†µä¸‹å¤„ç†å…¶ä»–åŸå› ã€‚
>
> è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œæ˜¯æ‰‹åŠ¨abortè°ƒç”¨æ˜¯å¦ä¼šè§¦å‘erroräº‹ä»¶ã€‚æ£€æŸ¥æ–‡æ¡£å‘ç°ï¼Œè°ƒç”¨abort()ä¼šè§¦å‘onabortäº‹ä»¶ï¼Œè€Œä¸æ˜¯onerroræˆ–ontimeoutã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨æ‰‹åŠ¨è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ç›‘å¬onabortäº‹ä»¶ï¼Œæˆ–è€…åœ¨è¶…æ—¶å¤„ç†å‡½æ•°ä¸­ç›´æ¥æ‰§è¡Œç›¸å…³æ“ä½œã€‚
>
> æ€»ç»“ï¼Œå›ç­”åº”è¯¥åŒ…æ‹¬ä¸¤ç§æ–¹æ³•ï¼š1ï¼‰ä½¿ç”¨åŸç”Ÿtimeoutå±æ€§ï¼Œå¦‚æœæ”¯æŒçš„è¯ï¼›2ï¼‰åœ¨ä¸æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨setTimeoutå’Œabortæ‰‹åŠ¨å®ç°ã€‚å¦å¤–éœ€æ³¨æ„å¤„ç†ç›¸å…³äº‹ä»¶ï¼Œåˆç†æ¸…ç†èµ„æºï¼ˆä¾‹å¦‚æ¸…é™¤å®šæ—¶å™¨ï¼‰ã€‚
>
> 



åœ¨åŸç”Ÿ JavaScript ä¸­ä½¿ç”¨ `XMLHttpRequest`ï¼ˆXHRï¼‰å®ç°è¯·æ±‚è¶…æ—¶ï¼Œå¯ä»¥é€šè¿‡ **ä¸¤ç§æ–¹å¼** å®ç°ï¼šä¸€ç§æ˜¯åˆ©ç”¨ XHR åŸç”Ÿ `timeout` å±æ€§ï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰ï¼Œå¦ä¸€ç§æ˜¯æ‰‹åŠ¨æ¨¡æ‹Ÿè¶…æ—¶ï¼ˆå…¼å®¹è€æµè§ˆå™¨ï¼‰ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•åŠè¯¦ç»†è¯´æ˜ï¼š

---

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨åŸç”Ÿ `timeout` å±æ€§ï¼ˆæ¨èï¼‰

é€šè¿‡è®¾ç½® XHR å¯¹è±¡è‡ªå¸¦çš„ `timeout` å±æ€§ï¼Œå¯ç›´æ¥å®šä¹‰è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œå¹¶é€šè¿‡ç›‘å¬ `ontimeout` äº‹ä»¶å¤„ç†è¶…æ—¶é€»è¾‘ã€‚

```javascript
function requestWithTimeout(url, timeout = 5000) {
  const xhr = new XMLHttpRequest();

  // 1. è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
  xhr.timeout = timeout;

  // 2. ç›‘å¬è¶…æ—¶äº‹ä»¶
  xhr.ontimeout = function() {
    console.error("è¯·æ±‚è¶…æ—¶");
    // å¯æŠ›å‡ºè‡ªå®šä¹‰é”™è¯¯æˆ–æ‰§è¡Œå›è°ƒ
  };

  // 3. ç›‘å¬è¯·æ±‚å®Œæˆäº‹ä»¶
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        console.log("è¯·æ±‚æˆåŠŸ:", xhr.responseText);
      } else {
        console.error("è¯·æ±‚å¤±è´¥:", xhr.statusText);
      }
    }
  };

  // 4. å‘èµ·è¯·æ±‚
  xhr.open("GET", url, true);
  xhr.send();
}

// ä½¿ç”¨ç¤ºä¾‹
requestWithTimeout("https://api.example.com/data");
```

#### **ç‰¹ç‚¹**ï¼š
- **ç®€æ´é«˜æ•ˆ**ï¼šåŸç”Ÿæ”¯æŒè¶…æ—¶é€»è¾‘ï¼Œæ— é¢å¤–èµ„æºæ¶ˆè€—ã€‚
- **æµè§ˆå™¨å…¼å®¹æ€§**ï¼šéœ€æ”¯æŒ [XHR Level 2](https://caniuse.com/xhr2)ï¼ˆIE10+ã€Chrome 29+ã€Firefox 30+ï¼‰ã€‚

---

### æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨æ¨¡æ‹Ÿè¶…æ—¶ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰

å¯¹äºä¸æ”¯æŒ `timeout` å±æ€§çš„æµè§ˆå™¨ï¼Œé‡‡ç”¨ `setTimeout` + `abort()` æ‰‹åŠ¨å®ç°è¶…æ—¶ä¸­æ–­è¯·æ±‚ã€‚

```javascript
function requestWithManualTimeout(url, timeout = 5000) {
  const xhr = new XMLHttpRequest();
  let isTimeout = false;

  // 1. è®¾ç½®å®šæ—¶å™¨æ¨¡æ‹Ÿè¶…æ—¶
  const timer = setTimeout(() => {
    isTimeout = true;    // æ ‡è®°ä¸ºè¶…æ—¶
    xhr.abort();         // ä¸­æ–­è¯·æ±‚
    console.error("è¯·æ±‚è¶…æ—¶");
  }, timeout);

  // 2. ç›‘å¬è¯·æ±‚å®Œæˆæˆ–ä¸­æ–­äº‹ä»¶
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      clearTimeout(timer); // æ¸…ç†å®šæ—¶å™¨
      if (isTimeout) return; // å·²å¤„ç†è¶…æ—¶åˆ™é€€å‡º

      if (xhr.status === 200) {
        console.log("è¯·æ±‚æˆåŠŸ:", xhr.responseText);
      } else {
        console.error("è¯·æ±‚å¤±è´¥:", xhr.statusText);
      }
    }
  };

  // 3. ç›‘å¬è¯·æ±‚ä¸­æ–­ï¼ˆæ‰‹åŠ¨abortï¼‰
  xhr.onabort = function() {
    if (isTimeout) { // å¦‚æœè¶…æ—¶ä¸»åŠ¨abortçš„
      console.error("è¯·æ±‚å·²è¢«è¶…æ—¶ä¸­æ–­");
    }
  };

  // 4. å‘èµ·è¯·æ±‚
  xhr.open("GET", url, true);
  xhr.send();
}

// ä½¿ç”¨ç¤ºä¾‹
requestWithManualTimeout("https://api.example.com/data");
```

#### **å…³é”®ç‚¹**ï¼š
- **è®¡æ—¶å™¨ä¸è¯·æ±‚è§£è€¦**ï¼šé€šè¿‡ `setTimeout` é©±åŠ¨è¶…æ—¶é€»è¾‘ï¼Œè¯·æ±‚è¿”å›æ—¶æ¸…é™¤è®¡æ—¶å™¨ã€‚
- **è¶…æ—¶æ ‡å¿— (`isTimeout`)**ï¼šç”¨äºåŒºåˆ†æ­£å¸¸è¿”å›ä¸è¶…æ—¶ä¸­æ–­ã€‚
- **æ‰‹åŠ¨ç»ˆæ­¢è¯·æ±‚**ï¼šè°ƒç”¨ `xhr.abort()` å¼ºåˆ¶ç»ˆæ­¢æœªå®Œæˆçš„è¯·æ±‚ã€‚

#### **å…¼å®¹æ€§è¦†ç›–**ï¼š
- æ”¯æŒæ‰€æœ‰æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ä¸æ”¯æŒ `timeout` çš„æ—§ç‰ˆ IEï¼‰ã€‚

---

### é€‰æ‹©å»ºè®®

|          | åŸç”Ÿ `timeout` å±æ€§                     | æ‰‹åŠ¨æ¨¡æ‹Ÿè¶…æ—¶             |
|----------|----------------------------------------|--------------------------|
| **ä¼˜ç‚¹** | ä»£ç ç®€æ´ã€æ— é¢å¤–å¼€é”€                    | å…¼å®¹æ€§è¦†ç›–å¹¿             |
| **ç¼ºç‚¹** | ä¾èµ–æµè§ˆå™¨æ”¯æŒï¼ˆIE10+ï¼‰                 | éœ€æ‰‹åŠ¨å¤„ç†è®¡æ—¶å™¨å’Œä¸­æ–­   |
| **åœºæ™¯** | ç°ä»£æµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚ç§»åŠ¨ç«¯ã€ç°ä»£ Web åº”ç”¨ï¼‰| éœ€å…¼å®¹æ—§æµè§ˆå™¨çš„é¡¹ç›®      |

---

### å®Œæ•´ä»£ç ç¤ºä¾‹ï¼ˆç»„åˆæ–¹æ¡ˆï¼‰

```javascript
function smartRequest(url, timeout = 5000) {
  const xhr = new XMLHttpRequest();
  let isTimeout = false;

  // ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ timeoutï¼ˆè‹¥æµè§ˆå™¨æ”¯æŒï¼‰
  if ("timeout" in xhr) {
    xhr.timeout = timeout;
    xhr.ontimeout = function() {
      isTimeout = true;
      console.error("è¯·æ±‚è¶…æ—¶ï¼ˆåŸç”Ÿæ”¯æŒï¼‰");
    };
  } else {
    // æ‰‹åŠ¨æ¨¡æ‹Ÿè¶…æ—¶ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
    const timer = setTimeout(() => {
      isTimeout = true;
      xhr.abort();
      console.error("è¯·æ±‚è¶…æ—¶ï¼ˆæ‰‹åŠ¨æ¨¡æ‹Ÿï¼‰");
    }, timeout);

    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        clearTimeout(timer);
      }
    };
  }

  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && !isTimeout) {
      if (xhr.status === 200) {
        console.log("è¯·æ±‚æˆåŠŸ:", xhr.responseText);
      } else {
        console.error("è¯·æ±‚å¤±è´¥:", xhr.statusText);
      }
    }
  };

  xhr.open("GET", url, true);
  xhr.send();
}
```

æ­¤æ–¹æ¡ˆä¼˜å…ˆä½¿ç”¨åŸç”Ÿçš„ `timeout` å±æ€§ï¼Œåœ¨ä¸æ”¯æŒçš„æµè§ˆå™¨ä¸­é™çº§ä¸ºæ‰‹åŠ¨æ¨¡æ‹Ÿï¼Œå…¼é¡¾ç°ä»£ä¸è€æ—§ç¯å¢ƒã€‚
