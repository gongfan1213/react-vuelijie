> ğŸ’­ å—¯ï¼Œç”¨æˆ·çš„é—®é¢˜æ˜¯å…³äºé¡µé¢æ•°æ®é‡è¾ƒå¤§æ—¶çš„æ€§èƒ½ä¼˜åŒ–ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¼˜åŒ–éš¾åº¦è‚¯å®šæ¯”æ™®é€šé¡µé¢é«˜å¾ˆå¤šï¼Œæˆ‘å¾—ä»”ç»†æƒ³æƒ³å¦‚ä½•ç³»ç»Ÿåœ°å›ç­”ã€‚é¦–å…ˆéœ€è¦ç¡®å®šç”¨æˆ·è¯´çš„â€œæ•°æ®é‡è¾ƒå¤§â€å…·ä½“æŒ‡ä»€ä¹ˆï¼Œæ˜¯å¤§é‡çš„DOMå…ƒç´ ã€å¤§é‡çš„é™æ€èµ„æºå¦‚å›¾ç‰‡æˆ–è„šæœ¬ï¼Œè¿˜æ˜¯åŠ¨æ€åŠ è½½çš„æ•°æ®æ¯”å¦‚è¡¨æ ¼æˆ–åˆ—è¡¨ï¼Ÿ
>
> ç”¨æˆ·å¯èƒ½æ˜¯å‰ç«¯å¼€å‘è€…ï¼Œè´Ÿè´£å¼€å‘æˆ–ç»´æŠ¤ä¸€ä¸ªéœ€è¦å¤„ç†å¤§é‡æ•°æ®çš„ç½‘é¡µåº”ç”¨ï¼Œæ¯”å¦‚ç”µå•†çš„å•†å“åˆ—è¡¨ã€ç¤¾äº¤åª’ä½“çš„ä¿¡æ¯æµæˆ–è€…æ•°æ®åˆ†æçš„ä»ªè¡¨ç›˜ã€‚è¿™æ—¶å€™ä»–ä»¬é‡åˆ°çš„é—®é¢˜å¯èƒ½æ˜¯é¡µé¢åŠ è½½ç¼“æ…¢ï¼Œäº¤äº’å¡é¡¿ï¼Œç”šè‡³å´©æºƒï¼Œè¿™å¯¹ç”¨æˆ·ä½“éªŒå½±å“å¾ˆå¤§ï¼Œç›´æ¥å½±å“ä¸šåŠ¡æŒ‡æ ‡ã€‚
>
> æ¥ä¸‹æ¥è¦è€ƒè™‘ä¼˜åŒ–çš„æ–¹å‘ã€‚é€šå¸¸æ€§èƒ½ä¼˜åŒ–å¯ä»¥åˆ†ä¸ºåŠ è½½æ—¶å’Œè¿è¡Œæ—¶ä¸¤æ–¹é¢ã€‚åŠ è½½æ—¶ä¼˜åŒ–å¯èƒ½æ¶‰åŠä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€èµ„æºå‹ç¼©ç­‰ã€‚è¿è¡Œæ—¶ä¼˜åŒ–åˆ™å¯èƒ½åŒ…æ‹¬å‡å°‘é‡ç»˜å›æµã€è™šæ‹Ÿæ»šåŠ¨ã€Web Workerså¤„ç†æ•°æ®ç­‰ã€‚
>
> ç”¨æˆ·éœ€è¦çš„æ˜¯é¡µé¢çº§åˆ«çš„ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº”ç”¨çš„ä¼˜åŒ–ï¼Œè¿™å¯èƒ½æ„å‘³ç€è¦ä»DOMæ“ä½œã€æ¸²æŸ“æ•ˆç‡ã€å†…å­˜ç®¡ç†è¿™äº›æ–¹é¢å…¥æ‰‹ã€‚æ¯”å¦‚è¡¨æ ¼æ¸²æŸ“æˆåƒä¸Šä¸‡è¡Œæ•°æ®ï¼Œç›´æ¥æ“ä½œDOMä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œè¿™æ—¶å€™è™šæ‹Ÿåˆ—è¡¨æˆ–åˆ†é¡µåŠ è½½å¯èƒ½æ˜¯è§£å†³åŠæ³•ã€‚
>
> å¯èƒ½ä¼šå¿½ç•¥çš„ä¼˜åŒ–ç‚¹æ¯”å¦‚æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿çš„å„ä¸ªé˜¶æ®µï¼ˆJavaScriptã€æ ·å¼è®¡ç®—ã€å¸ƒå±€ã€ç»˜åˆ¶ã€åˆæˆï¼‰ï¼Œé’ˆå¯¹æ¯ä¸ªé˜¶æ®µå¦‚ä½•ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œé¿å…é¢‘ç¹çš„æ ·å¼æ›´æ”¹å¼•èµ·å¸ƒå±€æŠ–åŠ¨ï¼Œä½¿ç”¨CSSçš„transformå’Œopacityæ¥åˆ©ç”¨åˆæˆå±‚ï¼Œå‡å°‘é‡ç»˜ã€‚
>
> å¦å¤–ï¼Œæ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œå†…å­˜ç®¡ç†ä¹Ÿå¾ˆå…³é”®ã€‚æ¯”å¦‚ä¸åˆç†çš„å¯¹è±¡å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œæˆ–è€…åœ¨å¤„ç†æ•°æ®æ—¶äº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œè§¦å‘é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œé€ æˆé¡µé¢å¡é¡¿ã€‚éœ€è¦è€ƒè™‘å¦‚ä½•ä¼˜åŒ–æ•°æ®ç»“æ„ï¼ŒåŠæ—¶é‡Šæ”¾ä¸å†éœ€è¦çš„èµ„æºã€‚
>
> è¿˜è¦è€ƒè™‘ç½‘ç»œæ–¹é¢çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚æ•°æ®åˆ†é¡µã€æŒ‰éœ€åŠ è½½ã€‚å¯¹äºé¦–å±æ•°æ®ä¼˜å…ˆåŠ è½½ï¼Œéå…³é”®èµ„æºå»¶è¿ŸåŠ è½½ï¼Œä½¿ç”¨éª¨æ¶å±æå‡ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½ã€‚æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æˆ–é™æ€ç”Ÿæˆï¼ˆSSGï¼‰å¯èƒ½åœ¨æŸäº›åœºæ™¯ä¸‹æœ‰å¸®åŠ©ï¼Œå‡å°‘å®¢æˆ·ç«¯å¤„ç†çš„è´Ÿæ‹…ã€‚
>
> ä¸€äº›ç°ä»£APIå¦‚Intersection Observerå¯ä»¥å®ç°æ‡’åŠ è½½ï¼ŒResize Observerä»£æ›¿é¢‘ç¹çš„resizeäº‹ä»¶æ£€æµ‹ï¼Œè¿™äº›å¯èƒ½éƒ½æ˜¯ä¼˜åŒ–çš„ç‚¹ã€‚åŒæ—¶ï¼Œæ˜¯å¦éœ€è¦ä½¿ç”¨Web Assemblyæ¥å¤„ç†å¤æ‚è®¡ç®—ï¼Œä»è€Œå‡å°‘JavaScriptçš„å‹åŠ›ï¼Ÿ
>
> è°ƒè¯•å·¥å…·æ–¹é¢ï¼Œæ¯”å¦‚Chromeçš„Performanceé¢æ¿åˆ†æè¿è¡Œæ—¶ç“¶é¢ˆï¼ŒMemoryé¢æ¿æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œè¿™äº›å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ä¹Ÿéœ€è¦æåŠã€‚
>
> ç”¨æˆ·å¯èƒ½è¿˜å…³å¿ƒå¦‚ä½•å¹³è¡¡åŠŸèƒ½ä¸æ€§èƒ½ï¼Œæ¯”å¦‚åœ¨æ•°æ®å¤„ç†æ—¶è¿›è¡Œé˜²æŠ–ã€èŠ‚æµï¼Œæˆ–è€…å°†ä»»åŠ¡æ‹†åˆ†ä¸ºå°å—ï¼Œé€šè¿‡requestIdleCallbackæ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚
>
> ç»¼åˆä»¥ä¸Šæ€è·¯ï¼Œéœ€è¦åˆ†æ­¥éª¤è®²è§£ï¼Œä»åŠ è½½ä¼˜åŒ–ã€æ¸²æŸ“ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œä¼˜åŒ–ã€å·¥å…·ä½¿ç”¨ç­‰æ–¹é¢ç»™å‡ºå…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒæ—¶ç»“åˆä»£ç ç¤ºä¾‹å’Œå®è·µç»éªŒï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å¹¶åº”ç”¨è¿™äº›ä¼˜åŒ–ç­–ç•¥ã€‚è¿˜è¦æé†’ç”¨æˆ·è¿›è¡Œæ€§èƒ½ç›‘æ§ï¼Œç¡®ä¿ä¼˜åŒ–æªæ–½çš„æœ‰æ•ˆæ€§å’ŒæŒç»­æ”¹è¿›ã€‚
>
> 



åœ¨å¤„ç†å¤§æ•°æ®é‡çš„é¡µé¢æ—¶ï¼Œæ€§èƒ½ä¼˜åŒ–éœ€é‡ç‚¹å…³æ³¨ **DOMæ¸²æŸ“æ•ˆç‡**ã€**å†…å­˜ç®¡ç†**å’Œ**äº¤äº’å“åº”é€Ÿåº¦**ã€‚ä»¥ä¸‹æ˜¯ç»“åˆå®æˆ˜ç»éªŒçš„å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆï¼š

---

### **ä¸€ã€æ¸²æŸ“ä¼˜åŒ–ï¼šè§£å†³ã€Œæ¸²æŸ“å¡é¡¿ã€é—®é¢˜**
![](https://developers.google.com/static/web/static/images/docs/memory/avoid-large-complex-layouts-and-layout-thrashing/before-after.png)

#### 1. **è™šæ‹Ÿæ»šåŠ¨ (Virtual Scrolling)**
- **åœºæ™¯**ï¼šåˆ—è¡¨/è¡¨æ ¼å±•ç¤º 10 ä¸‡+æ¡ç›®æ—¶ç›´æ¥æ¸²æŸ“ä¼šä¸¥é‡é˜»å¡ä¸»çº¿ç¨‹ã€‚
- **å®ç°åŸç†**ï¼šä»…åœ¨å¯è§†åŒºåŸŸæ¸²æŸ“ DOM å…ƒç´ ï¼Œæ»šåŠ¨æ—¶åŠ¨æ€æ›¿æ¢å†…å®¹ã€‚
- **ä»£ç ç¤ºä¾‹ï¼ˆReact + react-windowï¼‰**ï¼š
  ```jsx
  import { FixedSizeList as List } from 'react-window';

  const Row = ({ index, style }) => (
    <div style={style}>Row {data[index].id}</div>
  );

  <List
    height={600}
    itemCount={100000}
    itemSize={35}
    width={800}
  >
    {Row}
  </List>
  ```
- **æ”¶ç›Š**ï¼šDOM èŠ‚ç‚¹æ•°ä» 10 ä¸‡å‡å°‘åˆ° ~30 ä¸ªï¼Œå†…å­˜å ç”¨å‡å°‘ **90%**ã€‚

#### 2. **Canvas/WebGL æ›¿ä»£ DOM**
- **åœºæ™¯**ï¼šè¶…å¤§æ•°æ®å¯è§†åŒ–ï¼ˆå¦‚åœ°å›¾æ ‡è®°ã€çƒ­åŠ›å›¾ï¼‰ã€‚
- **æŠ€æœ¯é€‰å‹**ï¼š
  ```mermaid
  graph LR
  A[å¤§æ•°æ®æ¸²æŸ“æ–¹å¼] --> B{æ˜¯å¦éœ€è¦äº¤äº’?}
  B -->|æ˜¯| C[Canvas + Konva.js/Echarts]
  B -->|å¦| D[WebGL + Three.js/Deck.gl]
  ```
- **å®æˆ˜æ¡ˆä¾‹**ï¼šä½¿ç”¨ `WebGL` æ¸²æŸ“ 50 ä¸‡ä¸ªæ•£ç‚¹ï¼š
  ```javascript
  const layer = new Deck.ScatterplotLayer({
    data: points,
    getPosition: d => d.coords,
    getRadius: 2,
    getFillColor: [255, 0, 0]
  });
  ```

---

### **äºŒã€å†…å­˜ä¼˜åŒ–ï¼šé¿å…ã€Œé¡µé¢å´©æºƒã€**
#### 1. **æ•°æ®åˆ†å—å¤„ç†**ï¼ˆChunk Processingï¼‰
- **åœºæ™¯**ï¼šè§£æ 100MB çš„ JSON æ•°æ®æ—¶é¡µé¢å†»ç»“ã€‚
- **ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
  ```javascript
  // ä½¿ç”¨ Generator åˆ†å—å¤„ç†
  async function* parseLargeJSON(jsonString, chunkSize = 10000) {
    const segments = jsonString.match(/[\s\S]{1,10000}/g);
    for (const chunk of segments) {
      yield JSON.parse(chunk);
      await new Promise(resolve => setTimeout(resolve, 0)); // é‡Šæ”¾ä¸»çº¿ç¨‹
    }
  }
  ```

#### 2. **å¯¹è±¡æ± æ¨¡å¼**ï¼ˆObject Poolï¼‰
- **åœºæ™¯**ï¼šé«˜é¢‘åˆ›å»º/é”€æ¯åŒç±»å¯¹è±¡ï¼ˆå¦‚å¼¹çª—ã€DOM èŠ‚ç‚¹ï¼‰ã€‚
- **å®ç°ä»£ç **ï¼š
  ```javascript
  class NodePool {
    constructor(createFn) {
      this.pool = [];
      this.createFn = createFn;
    }
    
    get() {
      return this.pool.pop() || this.createFn();
    }
    
    reuse(node) {
      this.pool.push(node);
    }
  }

  // ä½¿ç”¨æ± åŒ–æŠ€æœ¯åˆ›å»ºåˆ—è¡¨é¡¹
  const listItemPool = new NodePool(() => document.createElement('div'));
  ```

---

### **ä¸‰ã€JS æ‰§è¡Œä¼˜åŒ–ï¼šé™ä½ã€Œé•¿ä»»åŠ¡ã€é˜»å¡æ—¶é—´**
#### 1. **Web Workers å¹¶è¡Œè®¡ç®—**
- **åœºæ™¯**ï¼šæ’åº/è¿‡æ»¤ 10 ä¸‡æ¡æ•°æ®é€ æˆç•Œé¢å†»ç»“ã€‚
- **ä¸»çº¿ç¨‹ä»£ç **ï¼š
  ```javascript
  const worker = new Worker('data-processor.js');
  worker.postMessage({ type: 'sort', data: largeArray });
  worker.onmessage = e => {
    renderResults(e.data.sortedArray); 
  };
  ```
- **worker.js**ï¼š
  ```javascript
  self.onmessage = e => {
    if (e.data.type === 'sort') {
      const sorted = e.data.data.sort((a, b) => a - b);
      self.postMessage({ sortedArray: sorted });
    }
  };
  ```

#### 2. **æ—¶é—´åˆ‡ç‰‡è°ƒåº¦**ï¼ˆScheduler APIï¼‰
- **React 18+ åº”ç”¨åœºæ™¯**ï¼šå¤§é‡çŠ¶æ€æ›´æ–°æ—¶ä¿æŒäº¤äº’å“åº”ã€‚
  ```jsx
  import { startTransition } from 'react';

  // å°†éå…³é”®æ›´æ–°æ ‡è®°ä¸ºå¯ä¸­æ–­
  startTransition(() => {
    setBigData(newData); // React ä¼šè‡ªåŠ¨åˆ†ç‰‡å¤„ç†
  });
  ```

---

### **å››ã€ç½‘ç»œä¼˜åŒ–ï¼šå‡å°‘ã€Œæ•°æ®ä¼ è¾“ä½“ç§¯ã€**
#### 1. **äºŒè¿›åˆ¶ä¼ è¾“åè®®**
- **ä¼ ç»Ÿé—®é¢˜**ï¼šä¼ è¾“å¤§æ•°ç»„æ—¶ JSON ä½“ç§¯è¿‡å¤§ã€‚
- **ä¼˜åŒ–ç¤ºä¾‹**ï¼š
  ```javascript
  // æœåŠ¡ç«¯ (Node.js)
  const buffer = new Float32Array(largeArray).buffer;
  res.setHeader('Content-Type', 'application/octet-stream');
  res.send(Buffer.from(buffer));

  // å®¢æˆ·ç«¯
  fetch('/large-data')
    .then(res => res.arrayBuffer())
    .then(buf => {
      const dataArray = new Float32Array(buf);
    });
  ```
  **å‹ç¼©ç‡å¯¹æ¯”**ï¼š200MB JSON â†’ çº¦ 50MB Binaryã€‚

#### 2. **æŒ‰éœ€å­—æ®µåŠ è½½**
- **GraphQL å®ç°ç²¾å‡†æŸ¥è¯¢**ï¼š
  ```graphql
  query {
    products(first: 10000) {
      id    # ä»…è·å–å¿…è¦å­—æ®µ
      name
      thumbnail
    }
  }
  ```

---

### **äº”ã€ç›‘æ§ä¸è°ƒè¯•å·¥å…·**
#### 1. **åˆ†æå†…å­˜æ³„æ¼**ï¼ˆChrome DevToolsï¼‰
```bash
# å¼ºåˆ¶è§¦å‘åƒåœ¾å›æ”¶ï¼ˆæ’æŸ¥æ— æ³•å›æ”¶çš„å¯¹è±¡ï¼‰
chrome://flags/#enable-garbage-collection
```

#### 2. **Performance Monitor** å®æ—¶ç›‘æ§ï¼š
- JS Heap Size â” æ£€æµ‹å†…å­˜å¢é•¿
- DOM Nodes â” æ£€æŸ¥æœªæ¸…ç†çš„èŠ‚ç‚¹
- Event Listeners â” å‘ç°å†—ä½™ç»‘å®š

---

### **å…­ã€æ¶æ„çº§ä¼˜åŒ–æ–¹æ¡ˆ**
#### 1. **WebAssembly é‡è®¡ç®—æ¨¡å—**
- **åœºæ™¯**ï¼šè¿è¡Œå¤æ‚ç®—æ³•ï¼ˆå¦‚ç‰©ç†ä»¿çœŸã€å¯†ç å­¦è®¡ç®—ï¼‰ã€‚
- **Rust + WASM ç¤ºä¾‹**ï¼š
  ```rust
  // src/lib.rs
  #[wasm_bindgen]
  pub fn process_large_data(input: &[f64]) -> Vec<f64> {
    input.iter().map(|x| x * 2.0).collect()
  }
  ```
- **è°ƒç”¨é€Ÿåº¦**ï¼šç›¸æ¯” JS å¹³å‡æå‡ **3-5 å€**ã€‚

#### 2. **IndexedDB å®¢æˆ·ç«¯ç¼“å­˜**
- **å®ç°æœ¬åœ°å¤§æ•°æ®é›†å¿«é€ŸæŸ¥è¯¢**ï¼š
  ```javascript
  const db = await idb.openDB('bigDataStore', 1, {
    upgrade(db) {
      db.createObjectStore('data', { keyPath: 'id' });
    }
  });

  // æ‰¹é‡å­˜å‚¨ 10 ä¸‡æ¡æ•°æ®ï¼ˆç›¸æ¯” localStorage å®¹é‡æ›´å¤§ï¼‰
  await db.transaction('data', 'readwrite').store.add(largeDataset);
  ```

---

### **ä¼˜åŒ–æ•ˆæœéªŒè¯**
é€šè¿‡ Chrome Performance é¢æ¿å¯¹æ¯”ä¼˜åŒ–å‰åï¼š
| æŒ‡æ ‡         | ä¼˜åŒ–å‰       | ä¼˜åŒ–å       |
|--------------|-------------|-------------|
| **Largest Contentful Paint** | 4800ms | 1200ms |
| **Total Blocking Time**       | 4500ms | 320ms  |
| **JS Heap Memory**            | 1.2GB  | 220MB  |

---

**å…³é”®åŸåˆ™**:  
1. **å¯è§†åŒ–åŸåˆ™**ï¼šé¦–å±ä¼˜å…ˆæ¸²æŸ“éª¨æ¶å±ï¼Œæ•°æ®é€å±‚åŠ è½½  
2. **åˆ†è§£åŸåˆ™**ï¼šå°†å·¨å‹ä»»åŠ¡æ‹†åˆ†æˆ <50ms çš„å¾®ä»»åŠ¡å—  
3. **ç¼“å­˜åŸåˆ™**ï¼šå¤ç”¨å·²æœ‰è®¡ç®—ç»“æœå’Œ DOM ç»“æ„  

æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©é€‚ç”¨æ–¹æ¡ˆï¼Œå»ºè®®é¦–ç”¨ **è™šæ‹ŸåŒ– + Web Workers + åˆ†å—åŠ è½½** ç»„åˆæ‹³ã€‚
