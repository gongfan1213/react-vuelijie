> ğŸ’­ å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å›ç­”ä¸€ä¸ªå‰ç«¯é¢è¯•çš„é—®é¢˜ã€‚ç”¨æˆ·å¸Œæœ›æˆ‘æ¨¡æ‹Ÿä¸€ä¸ªä¸“ä¸šå‰ç«¯å·¥ç¨‹å¸ˆåœ¨é¢è¯•ä¸­çš„å›ç­”ï¼Œå¹¶ä¸”è¦ç»“åˆå¸¸è§é—®é¢˜ã€æ·±å…¥åŸç†å’Œæºç ï¼Œç»™å‡ºæ»¡åˆ†ç­”æ¡ˆã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦æ˜ç¡®ç”¨æˆ·çš„é—®é¢˜ï¼Œä½†ç›®å‰ä»–ä»¬è¿˜æ²¡æœ‰æä¾›å…·ä½“çš„é—®é¢˜å†…å®¹ã€‚æœ‰å¯èƒ½ç”¨æˆ·æ¥ä¸‹æ¥ä¼šæå‡ºå…·ä½“çš„é—®é¢˜ï¼Œæˆ–è€…å¯èƒ½è¿™ä¸ªæç¤ºéœ€è¦å…ˆè¢«å¤„ç†ã€‚
>
> ä¸è¿‡ï¼Œæ ¹æ®ç”¨æˆ·çš„æè¿°ï¼Œä»–ä»¬å¯èƒ½è¿˜æ²¡æœ‰è¾“å…¥å…·ä½“çš„é—®é¢˜ã€‚è¿™æ—¶å€™ï¼Œæˆ‘éœ€è¦æç¤ºç”¨æˆ·æä¾›å…·ä½“çš„é—®é¢˜å†…å®¹ï¼Œä»¥ä¾¿æˆ‘èƒ½å¤Ÿè¿›è¡Œé’ˆå¯¹æ€§çš„å›ç­”ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½éœ€è¦å›ç­”å…³äºReactç”Ÿå‘½å‘¨æœŸã€è™šæ‹ŸDOMã€æ€§èƒ½ä¼˜åŒ–ã€é—­åŒ…ã€äº‹ä»¶å¾ªç¯ã€CSSå¸ƒå±€ç­‰æ–¹é¢çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘çš„ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯è¯·æ±‚ç”¨æˆ·æä¾›å…·ä½“çš„é¢è¯•é¢˜ç›®ã€‚
>
> ä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥è¿™æ ·å›å¤ï¼š
>
> â€œå½“ç„¶ï¼Œè¯·æä¾›æ‚¨éœ€è¦è§£ç­”çš„å…·ä½“å‰ç«¯å¼€å‘é¢è¯•é—®é¢˜ï¼Œæˆ‘ä¼šä»¥ä¸“ä¸šä¸”è¯¦ç»†çš„æ–¹å¼ä¸ºæ‚¨è§£æï¼ŒåŒ…æ‹¬åŸç†ã€æºç åŠå®é™…å¼€å‘ä¸­çš„å¸¸è§é—®é¢˜ã€‚â€
>
> ç¡®ä¿ç”¨æˆ·åœ¨æå‡ºé—®é¢˜åï¼Œæˆ‘å¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜å±•å¼€æ·±å…¥çš„åˆ†æï¼Œæ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚
>
> 



å½“ç„¶ï¼Œè¯·æä¾›æ‚¨éœ€è¦è§£ç­”çš„å…·ä½“å‰ç«¯å¼€å‘é¢è¯•é—®é¢˜ï¼Œæˆ‘ä¼šä»¥ä¸“ä¸šä¸”è¯¦ç»†çš„æ–¹å¼ä¸ºæ‚¨è§£æï¼ŒåŒ…æ‹¬åŸç†ã€æºç åŠå®é™…å¼€å‘ä¸­çš„å¸¸è§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºèŒƒæ¡ˆä¾‹ä¾›å‚è€ƒï¼š

---

**é—®é¢˜**ï¼šè¯·è§£é‡ŠVue3å“åº”å¼ç³»ç»Ÿçš„å®ç°åŸç†ï¼Œå¹¶è¯´æ˜ä¸Vue2çš„Object.definePropertyæ–¹æ¡ˆç›¸æ¯”æœ‰å“ªäº›æ”¹è¿›ï¼Ÿ

**æ»¡åˆ†å›ç­”å¤§çº²**ï¼š

1. **æ ¸å¿ƒåŸç†é˜è¿°**  
   Vue3é‡‡ç”¨Proxyä»£ç†æœºåˆ¶å®ç°å“åº”å¼ï¼Œé€šè¿‡`reactive()`å‡½æ•°é€’å½’ä»£ç†å¯¹è±¡ï¼Œç”¨`ref()`å¤„ç†åŸºæœ¬ç±»å‹å€¼ã€‚Proxyå¯ç›´æ¥ç›‘å¬å¯¹è±¡å¢åˆ ã€æ•°ç»„ç´¢å¼•å˜æ›´ç­‰æ·±å±‚æ“ä½œã€‚

2. **å†…å­˜ç»“æ„è§£æ**  
   ```typescript
   const targetMap = new WeakMap() // ç›®æ ‡å¯¹è±¡ -> é”®: ä¾èµ–æ˜ å°„
   class Dep {
     effects = new Set()
     // track/triggeré€»è¾‘...
   }
   ```
   æ¯ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½å¯¹åº”ä¸€ä¸ª`Dep`ä¾èµ–é›†åˆï¼Œå®ç°ç²¾ç¡®çš„ä¾èµ–æ”¶é›†ã€‚

3. **ç¼–è¯‘æ—¶ä¼˜åŒ–**  
   - PatchFlagæ ‡è®°åŠ¨æ€èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚`1 /* TEXT */`ï¼‰
   - Block Treeå‡å°‘å¯¹æ¯”å±‚çº§
   ```javascript
   // ç¼–è¯‘åä»£ç ç¤ºä¾‹
   _createVNode("div", null, [
     _hoisted_1, // é™æ€èŠ‚ç‚¹
     _createTextVNode(_ctx.dynamicVal, 1 /* TEXT */)
   ], 64 /* STABLE_FRAGMENT */)
   ```

4. **å¯¹æ¯”Vue2ç¼ºé™·ä¸æ”¹è¿›**  
   | ç‰¹æ€§                | Vue2                 | Vue3                |
   |---------------------|----------------------|---------------------|
   | ç›‘æµ‹æœºåˆ¶            | Object.defineProperty| Proxy               |
   | æ•°ç»„ç›‘å¬            | éœ€é‡å†™æ–¹æ³•           | ç›´æ¥ç´¢å¼•è§¦è¾¾       |
   | æ–°å¢å±æ€§            | $setå¼ºåˆ¶æ›´æ–°         | è‡ªåŠ¨å“åº”           |
   | åµŒå¥—å¯¹è±¡            | é€’å½’åˆå§‹åŒ–           | æƒ°æ€§ä»£ç†           |
   | å†…å­˜å ç”¨            | å…¨é‡åŠ«æŒ            | æŒ‰éœ€æ”¶é›†ä¾èµ–       |

5. **æ€§èƒ½æ¡ˆä¾‹å¯¹æ¯”**  
   å¤§å‹è¡¨å•åœºæ™¯ä¸‹ï¼Œ1000ä¸ªå­—æ®µåˆå§‹åŒ–é€Ÿåº¦æå‡40%ï¼Œå†…å­˜å ç”¨é™ä½30%ã€‚é€šè¿‡`console.profile`å¯éªŒè¯ç›‘å¬å™¨åˆ›å»ºè€—æ—¶å‡å°‘ã€‚

6. **æºç å…³é”®é€»è¾‘**  
   ```typescript
   // reactivity/reactive.ts
   function reactive(target) {
     const proxy = new Proxy(target, {
       get(target, key, receiver) {
         track(target, key)
         return Reflect.get(...arguments)
       },
       set(target, key, value, receiver) {
         const res = Reflect.set(...arguments)
         trigger(target, key)
         return res
       }
     })
     return proxy
   }
   ```

**è½åœ°å®è·µè¦ç‚¹**ï¼š  
- é¿å…è¶…å¤§å¯¹è±¡çš„æ·±åº¦å“åº”å¼è½¬æ¢ï¼Œå¿…è¦æ—¶ä½¿ç”¨`shallowRef`
- åˆç†ä½¿ç”¨`markRaw`è·³è¿‡ä¸éœ€è¦å“åº”çš„æ•°æ®
- ç»„åˆå¼APIé…åˆ`computed`å®ç°ç²¾å‡†æ›´æ–°

---

è¯·æä¾›æ‚¨éœ€è¦æ·±å…¥è§£æçš„å…·ä½“é—®é¢˜ï¼Œæˆ‘å°†æŒ‰ç…§æ­¤æ ‡å‡†ä¸ºæ‚¨å‡†å¤‡ä¸“ä¸šè§£ç­”ã€‚
